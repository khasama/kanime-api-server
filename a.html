<form action="http://localhost:3456/api/v1/anime/" method="post" enctype="multipart/form-data">
    <input type="text" name="name" placeholder="name"> <br>
    <input type="text" name="othername" placeholder="othername"> <br>
    <input type="text" name="content" placeholder="content"> <br>
    <input type="number" name="year" placeholder="year"><br>
    <input type="file" name="image" accept="image/png, image/gif, image/jpeg"><br>
    <input type="file" name="imagebg" accept="image/png, image/gif, image/jpeg"><br>
    <button type="submit">submit</button>
</form>

<hr>

<div style="display: flex;">
    <div>
        <input type="text" name="name" placeholder="name" id="uname"> <br>
        <input type="text" name="othername" placeholder="othername" id="uothername"> <br>
        <input type="text" name="content" placeholder="content" id="ucontent"> <br>
        <input type="number" name="year" placeholder="year" id="uyear"><br>
        <input type="number" name="view" placeholder="view" id="uview"><br>
        <input type="number" name="liked" placeholder="liked" id="uliked"><br>
        <input type="number" name="mainserver" placeholder="mainserver" id="umainserver"><br>
        <input type="number" name="status" placeholder="status" id="ustatus"><br>
        <input type="file" name="nimage" id="uimage"><br>
        <img src="" alt="" id="img" width="100"> <br>
        <input type="file" name="nimagebg" id="uimagebg"><br>
        <img src="" alt="" id="imgbg" width="300"> <br>
        <input type="hidden" name="image" id="cimage"> 
        <input type="hidden" name="imagebg" id="cimagebg">

        <div class="genre-list" id="list">

        </div>

        <button id="btn-update">
            Update
        </button>
    </div>

    <div >
        <div id="genres">

        </div>

        <hr>

        <div id="series">

        </div>

    </div>
</div>



<script>
    fetch('http://localhost:3456/api/v1/anime/119')
    .then(response => response.json())
    .then(data => {
        const anime = data.data;
        setData(anime);
    });

    fetch('http://localhost:3456/api/v1/genre/all')
    .then(response => response.json())
    .then(data => {
        const genre = data.data;
        const genres = document.getElementById("genres");
        genre.forEach(ele => {
            genres.insertAdjacentHTML('beforeend', `
                <a href="javascript:void(0)" onclick="addGenre(this)" data-id="${ele.idGenre}" style="margin-right:10px;">${ele.Genre}</a> 
                `
            );
        });
    });

    fetch('http://localhost:3456/api/v1/series/all')
    .then(response => response.json())
    .then(data => {
        const seri = data.data;
        const series = document.getElementById("series");
        seri.forEach(ele => {
            series.insertAdjacentHTML('beforeend', `
                <a href="javascript:void(0)" onclick="addSeries(this)" data-id="${ele.idSeries}" style="margin-right:10px;">${ele.Series}</a> 
                `
            );
        });
    });

    document.querySelector("#btn-update").addEventListener('click', () => {
        
        const formData = new FormData();
        const image = document.querySelector('#uimage');
        const imagebg = document.querySelector('#uimagebg');

        formData.append('name', document.getElementById("uname").value);
        formData.append('othername', document.getElementById("uothername").value);
        formData.append('content', document.getElementById("ucontent").value);
        formData.append('year', document.getElementById("uyear").value);
        formData.append('view', document.getElementById("uview").value);
        formData.append('liked', document.getElementById("uliked").value);
        formData.append('mainserver', document.getElementById("umainserver").value);
        formData.append('status', document.getElementById("ustatus").value);
        formData.append('imagebg', document.getElementById("cimagebg").value);
        formData.append('image', document.getElementById("cimage").value);

        if(image.files[0] != undefined){
            formData.append('nimage', image.files[0]);
        }
        if(imagebg.files[0] != undefined){
            formData.append('nimagebg', imagebg.files[0]);
        }

        fetch('http://localhost:3456/api/v1/anime/update/119', {
            method: 'PUT',
            body: formData
        })
        .then(response => response.json())
        .then(result => {
            const anime = result.data;
            setData(anime);
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }, false);

    function deleteGenre(ele){
        const idGA = ele.getAttribute('data-id');
        fetch('http://localhost:3456/api/v1/anime/delete-genre', {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({idGA, idAnime:119})
        })
        .then(response => response.json())
        .then(result => {
            const anime = result.data;
            setData(anime);
            
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }

    function setData(anime){
        const url = "http://localhost:3456/public/anime/"
        document.getElementById("uname").value = anime.Name;
        document.getElementById("uothername").value = anime.OtherName;
        document.getElementById("ucontent").value = anime.Content;
        document.getElementById("uyear").value = anime.idYear;
        document.getElementById("uview").value = anime.View;
        document.getElementById("uliked").value = anime.Liked;
        document.getElementById("umainserver").value = anime.MainServer;
        document.getElementById("ustatus").value = anime.idStatus;
        document.getElementById("cimage").value = anime.Image;
        document.getElementById("cimagebg").value = anime.ImageBG;
        document.querySelector("#img").setAttribute("src", url+anime.Image);
        document.querySelector("#imgbg").setAttribute("src", url+anime.ImageBG);
        const list = document.getElementById("list");
        list.innerHTML = '';
        anime.Genre.forEach(ele => {
            list.insertAdjacentHTML('beforeend', `
                <a href="javascript:void(0)" class="genre-item" onclick="deleteGenre(this)" data-id="${ele.idGA}">${ele.Genre}</a> 
                `
            );
        });
    }

    function addGenre(ele){
        const idGenre = ele.getAttribute('data-id');
        fetch('http://localhost:3456/api/v1/anime/add-genre', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({anime:119, genre:idGenre})
        })
        .then(response => response.json())
        .then(result => {
            if(result.message == "Failed"){
                alert(result.error);
            }else{
                const anime = result.data;
                setData(anime);
            }
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }
    
</script>